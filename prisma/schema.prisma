generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

enum UserStatus {
  active
  suspended
  banned
}

model Theme {
  id        Int      @id @default(autoincrement())
  slug      String   @unique
  name      String
  isDefault Boolean  @default(false)
  variables Json
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([isDefault])
}

enum PictureWordType {
  noun
  adding
  animal
  person
  occupation
  notPersonal
  humanBody
  relationalObj
  personAdj
  personAdj_adj
  adj
  food
  place
  accessory
  tool
  sport
}

enum PictureWordUsage {
  Job
  adj
  person
  free
  notSet
}

model Word {
  id                               Int      @id @default(autoincrement())
  anki_link_id                     String   @unique
  base_form                        String
  phonetic_us                      String?
  phonetic_us_normalized           String?
  meaning_fa                       String
  meaning_fa_IPA                   String
  meaning_fa_IPA_normalized        String   @default("")
  pos                              String?
  concept_explained                String?
  concept_explained_fa             String?
  word_hint_story                  String?
  sentence_en                      String
  sentence_en_meaning_fa           String?
  explanation_for_sentence_meaning String?
  learning_depth                   Float?
  mixed_sentence                   String?
  other_meanings_fa                String?
  category                         String?
  typeOfWordInDb                   String   @default("temp")
  hint_sentence                    String?
  first_letter_en_hint             String?
  first_letter_fa_hint             String?
  hint_to_select                   String?
  json_hint                        String?
  word_note                        String?
  common_error                     String?
  /// Score 0-100: how imageable/visual the word is (default 10).
  imageability                     Int      @default(10)
  createdAt                        DateTime @default(now())
  updatedAt                        DateTime @updatedAt

  @@index([base_form])
  @@index([typeOfWordInDb])
}

model IpaKeyword {
  id        Int      @id @default(autoincrement())
  number    Int      @unique
  fa        String
  faPlain   String   @default("")
  ipa_fa    String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([fa])
  @@index([faPlain])
}

model PictureWord {
  id          Int             @id @default(autoincrement())
  fa          String
  ipa_fa      String
  ipa_fa_normalized String    @default("")
  phinglish   String
  en          String
  type        PictureWordType @default(noun)
  usage       PictureWordUsage @default(notSet)
  canBePersonal Boolean       @default(false)
  ipaVerified Boolean         @default(false)
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt

  @@unique([fa, en])
  @@index([fa])
  @@index([en])
}

model User {
  id             String       @id @default(cuid())
  name           String?
  email          String       @unique
  emailVerified  DateTime?
  image          String?
  hashedPassword String?
  status         UserStatus   @default(active)
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt

  accounts       Account[]
  sessions       Session[]
  roles          UserRole[]
  passwordResets PasswordResetToken[]
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@index([userId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model PasswordResetToken {
  id        String   @id @default(cuid())
  userId    String
  token     String   @unique
  expiresAt DateTime
  usedAt    DateTime?
  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model Role {
  id          String           @id @default(cuid())
  name        String           @unique
  description String?
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt

  users       UserRole[]
  permissions RolePermission[]
}

model Permission {
  id          String           @id @default(cuid())
  name        String           @unique
  description String?
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt

  roles       RolePermission[]
}

model UserRole {
  userId String
  roleId String

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  role Role @relation(fields: [roleId], references: [id], onDelete: Cascade)

  @@id([userId, roleId])
  @@index([roleId])
}

model RolePermission {
  roleId       String
  permissionId String

  role       Role       @relation(fields: [roleId], references: [id], onDelete: Cascade)
  permission Permission @relation(fields: [permissionId], references: [id], onDelete: Cascade)

  @@id([roleId, permissionId])
  @@index([permissionId])
}
